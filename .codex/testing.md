## 2026-01-04
- 任务：撰写 `AGENTS.md` 贡献指南
- 执行结果：未运行自动化或手动测试；本次仅新增文档，未触达 Python 代码路径
- 说明：仓库无现成测试套件，且改动不影响运行逻辑，后续若功能代码更新需按指南完成 `python run_app.py` 冒烟

## 2026-01-04（漫画提示词优化）
- 任务：恢复对白/旁白/音效到提示词，并修复 scene_id 解析
- 执行结果：未运行应用级冒烟；生成/导出链路涉及多进程 LL M/GUI，需人工验证
- 说明：本地无法快速模拟完整漫画生成流程；请在 GUI 中重新生成分镜并导出漫画 PDF 以确认文字与场景目录正常

## 2026-01-04（语言控制）
- 任务：为提示词添加语言指令，确保对白/旁白/音效按配置语言生成
- 执行结果：未运行应用级冒烟；需在应用内针对不同语言配置重新生成画格验证
- 说明：LLM/生图模型对语言指令响应程度需实际生成结果确认，建议针对中文/日文/英文等场景验收

## 2026-01-04（小说生成 Bug 排查）
- 任务：审阅 ChapterGenerationWorkflow/Service/Router 并更新 `docs/BUG_REPORT.md`
- 执行结果：未运行任何测试；本轮仅做静态代码审查与文档更新
- 说明：改动不涉及 Python 行为代码，且章节生成链路需要完整 LLM/GUI 才能验证；记录的缺陷需待后续修复后再进行应用级冒烟

## 2026-01-04（小说生成 Bug 排查 - 第二轮）
- 任务：补充提示词预览与 SSE 接口的缺陷条目
- 执行结果：未运行；仅分析代码与更新文档
- 说明：无代码改动，仍需在修复后通过实际章节生成验证

## 2026-01-04（小说生成 Bug 排查 - 第三轮）
- 任务：核实 completed 状态与章节生成接口不一致的问题
- 执行结果：未运行；仅在源码中比对状态校验
- 说明：待修复后再通过 GUI 流程验证完结项目的重生能力

## 2026-01-04（漫画 PDF 排查）
- 任务：审查 PDF 导出服务与路由参数，记录版本过滤与 layout 失效缺陷
- 执行结果：未运行；本次只做静态审查与文档更新
- 说明：问题涉及导出逻辑，需在修复后通过生成多版本图片、切换 layout 参数来验证

## 2026-01-04（漫画前端提示词数据排查）
- 任务：检查漫画 Tab 生成图片/预览链路对白与音效参数传递
- 执行结果：未运行；仅阅读前端源码并更新 `docs/BUG_REPORT.md`
- 说明：需在修复 `dialogues` 解析与音效细节累积后，通过 GUI 生成包含多条对白与音效的画格来验证

## 2026-01-04（漫画 API 语言字段）
- 任务：核对漫画提示词 API 与前端语言设置的对接
- 执行结果：未运行；只做静态比对并记录缺陷
- 说明：修复 `dialogue_language` 响应后，需要重新生成漫画分镜再生成图片，确认不同语言的对白能正确传递到生图服务

## 2026-01-04（章节版本 ID 传递缺失）
- 任务：排查图片生成与 PDF 导出链路的版本追溯字段
- 执行结果：未运行；仅阅读前后端源码
- 说明：待前端补充 `chapter_version_id` 参数后，需要在选择不同章节版本的场景下重新生成图片与 PDF，验证数据库中的 `GeneratedImage.chapter_version_id` 正确写入并能被 PDF 过滤

## 2026-01-04（漫画 PDF 版本筛选）
- 任务：核查 PDF 导出请求是否支持传入章节版本
- 执行结果：未运行；只进行代码审查
- 说明：修复前端参数与 UI 后，需要在多版本章节上生成/导出漫画 PDF，确认请求体可携带 `chapter_version_id` 并且后端只输出对应版本的图片

## 2026-01-04（删除分镜未清理图片）
- 任务：检查 DELETE/manga-prompts 是否同步删除旧图片
- 执行结果：未运行；仅阅读 API 与服务实现
- 说明：修复后需在 GUI 中执行“删除分镜”，再调用章节图片列表与检查磁盘，确认对应 `generated_images` 记录与文件都被清理

## 2026-01-04（PDF 下载链接）
- 任务：验证导出接口返回的 download_url 是否适用于远程服务器
- 执行结果：未运行；通过静态审查确认 download_url 为相对路径
- 说明：修复后需在 base_url 指向远程服务器的环境中生成 PDF，测试下载链接是否能在本地浏览器正确访问

## 2026-01-04（漫画 PDF/持久化排查 - 第四轮）
- 任务：审查 PDF 预览本地路径依赖、漫画提示词语言与源版本持久化、PDF 导出的图片选中策略，并在 `docs/BUG_REPORT.md` 中新增问题29-32
- 执行结果：未运行任何自动化或手动测试；仅进行静态代码分析与文档更新
- 说明：需在后续修复后，实际在远程后端环境生成漫画 PDF、刷新漫画分镜并切换章节版本、标记图片再导出 PDF，以确认预览/语言/版本/选中状态全部生效

## 2026-01-04（漫画面板刷新逻辑）
- 任务：排查漫画 Tab “刷新图片”对 PDF 信息的影响并在 `docs/BUG_REPORT.md` 增加问题33
- 执行结果：未运行；仅阅读前端构建器与 PDF Tab 源码
- 说明：修复后需在 GUI 中执行刷新图片按钮，验证 PDF 下载/预览状态不会丢失、标签文案仍为“漫画”，并确认 PDF 信息与图片列表可同时更新

## 2026-01-04（版本切换与漫画同步）
- 任务：检查章节版本切换后漫画数据是否刷新，并在 `docs/BUG_REPORT.md` 增加问题34
- 执行结果：未运行；仅阅读前端版本管理、章节显示及漫画懒加载逻辑
- 说明：修复后需在 GUI 中切换章节版本并确认漫画 Tab 会自动重新加载最新分镜/图片/PDF，避免旧章节内容残留

## 2026-01-04（场景元数据丢失）
- 任务：确认漫画场景摘要/情感等元数据在保存和读取流程中被抹掉，并在 `docs/BUG_REPORT.md` 增加问题35
- 执行结果：未运行；仅比对前端 `scene_card` 所需字段与 `PagePromptResult`/`MangaPromptRepository` 的持久化结构
- 说明：修复后需重新生成漫画分镜并刷新应用，验证场景摘要、情感标签、排版信息在生成后和重新打开项目时都能显示

## 2026-01-04（panel 槽位字段缺失）
- 任务：确认后台 `PanelResponse` 未返回 `slot_id` 导致前端画格标签恒为 `P?-0`，并在 `docs/BUG_REPORT.md` 增加问题36
- 执行结果：未运行；通过阅读 API 模型与前端 `prompt_tab` 代码定位缺失
- 说明：修复后需重新获取漫画分镜，检查每个画格的标签是否正确显示 `P{page}-{slot_id}`，并验证 PDF/图片导出使用相同槽位信息

## 2026-01-04（图片 URL 与 PDF 版本回退）
- 任务：确认图片生成/查询接口返回的 `url` 指向不存在的 `/api/images/...`，以及一页一图 PDF 在未指定版本时只返回 `chapter_version_id IS NULL` 的 legacy 图片
- 执行结果：未运行；仅通过静态代码分析和接口定义核对
- 说明：修复后需在远程环境中直接访问 `GeneratedImageInfo.url` 验证可下载图片，并在存在版本化图片的章节上生成 PDF，确认未指定版本时仍能导出最新图片且回退逻辑可以选择其他版本
## 2026-01-04（漫画图片映射与版本过滤）
- 任务：继续排查漫画图片加载逻辑，确认画格卡片是否指向最新图片以及 `GET /chapters/{chapter}/images` 是否支持版本过滤，并在 `docs/BUG_REPORT.md` 新增问题39-40
- 执行结果：未运行；本轮只做静态代码审查
- 说明：修复后需在同一画格反复生成多张图片，验证卡片始终展示最新结果，并在不同章节版本下重新加载图片接口，确认查询参数能够过滤到指定版本的数据

## 2026-01-04（BUG_REPORT 复核）
- 任务：复核 `docs/BUG_REPORT.md` 中剩余缺陷，确认哪些问题已经在代码中修复并更新文档
- 执行结果：未运行任何测试；本轮仅通过 `sed`/`rg` 阅读前后端源码，删除已修复条目并保留仍存在的 8 个问题
- 说明：待各缺陷修复后需分别通过章节生成、漫画提示词、图片生成与 PDF 导出实际流程验证修复效果

## 2026-01-04（章节图片版本过滤缺失）
- 任务：审查漫画图片加载流程，确认 `_loadChapterImages` 与 API 客户端未传 `chapter_version_id`
- 执行结果：未运行；仅静态分析前后端源码并更新 `docs/BUG_REPORT.md`
- 说明：修复后需在拥有多个版本的章节中切换版本，验证图片列表只展示当前版本的图片且 PDF 导出也能对应当前版本

## 2026-01-04（API 基础地址配置缺失）
- 任务：确认桌面端无法读取用户配置的 API 基础地址，始终固定访问 `http://127.0.0.1:8123`
- 执行结果：未运行；仅检视 `AFNAPIClient`、`APIClientManager` 与 `ConfigManager` 的实现
- 说明：修复后需要在设置界面修改 base_url，并验证所有 REST/SSE 请求（包括 PDF 下载）都指向新地址

## 2026-01-04（远程图片加载失败）
- 任务：检查漫画图片加载和 PDF Tab 依赖本地文件路径的问题
- 执行结果：未运行；只阅读前端源码与后端 `GeneratedImageInfo` 定义
- 说明：修复后需在远程后端环境中生成图片，确认漫画卡片/预览能通过 HTTP URL 加载而无需共享磁盘

## 2026-01-04（章节详情同步请求导致 UI 卡死）
- 任务：审查小说详情页的章节列表，确认章节详情与导入动作直接在主线程调用 API
- 执行结果：未运行；仅对比 `ChaptersSection` 与写作台 `ChapterDisplayMixin` 的实现
- 说明：修复后需手动在慢速或远程后端环境中快速切换章节/导入章节，验证 UI 不再冻结

## 2026-01-04（图片 URL 缺陷复查）
- 任务：复核 `ImageGenerationService` 返回的图片下载链接，并在 `docs/BUG_REPORT.md` 新增问题13
- 执行结果：未运行；本次只阅读后端服务与路由源码并更新文档
- 说明：修复后需在 GUI 中立即查看刚生成的图片，确认响应里的 `images[i].url` 可直接访问，无需重新加载列表

## 2026-01-04（章节版本ID缺失）
- 任务：审查章节序列化 Schema，确认 API 没有返回 `selected_version_id`
- 执行结果：未运行；仅静态分析 `NovelSerializer` 与前端调用点
- 说明：修复后需在 GUI 中切换章节并调用漫画生成/图片加载，确认请求体能够携带 `chapter_version_id` 且接口响应发生变化

## 2026-01-04（API 客户端线程安全）
- 任务：检查 API 客户端的并发模型，确认所有后台线程共享同一个 `requests.Session`
- 执行结果：未运行；仅阅读 `APIClientManager`、`AFNAPIClient`、`AsyncAPIWorker` 与 `chapter_cache` 预取逻辑
- 说明：修复后需在 GUI 中并发执行章节加载/漫画生成等操作，确认不会再出现随机的连接错误或 Session 冲突

## 2026-01-04（漫画语言&批量生成阻塞排查）
- 任务：确认漫画图片生成/预览请求未传递 `dialogue_language`，以及一键生成按钮在主线程同步请求所有漫画数据
- 执行结果：未运行；本轮仅通过静态分析前后端源码并更新 `docs/BUG_REPORT.md`
- 说明：修复语言字段后需在不同语言配置下重新生成漫画分镜并触发生图/预览，验证图片中文字遵循设定；修复批量生成异步化后需在远程后端环境中点击“一键生成”，确认 UI 不再卡顿

## 2026-01-04（漫画 source_version 追踪缺失）
- 任务：排查漫画提示词保存流程是否记录章节版本 ID
- 执行结果：未运行；仅静态阅读 `MangaPromptServiceV2._save_result` 与 `MangaPromptRepository.save_result`
- 说明：修复后需在章节切换到不同版本后重新生成漫画分镜，并在数据库或 API 响应中确认 `source_version_id` 已正确写入，可用于后续导出/清理流程

## 2026-01-04（生成漫画分镜前阻塞 UI）
- 任务：审查 `_onGenerateMangaPrompt` 点击逻辑，确认是否在主线程同步调用 REST 接口
- 执行结果：未运行；仅静态阅读 `manga_handlers.py:293-327`
- 说明：修复后需在远程后端场景中点击“生成漫画分镜”，验证按钮响应立即显示 loading，且网络慢时不再卡死 UI

## 2026-01-04（漫画工具栏按钮状态错乱）
- 任务：检查漫画工具栏中“生成分镜”和“一键生成”按钮的状态栈是否互相干扰
- 执行结果：未运行；仅通过静态阅读 `ToolbarMixin._create_toolbar` 及 `set_generate_all_*` 方法确认两个按钮共用 UI 栈
- 说明：修复后需在 GUI 中交替点击“生成分镜”和“一键生成图片”，再刷新漫画 Tab，确认两个按钮及其进度指示互不干扰且可恢复初始状态
