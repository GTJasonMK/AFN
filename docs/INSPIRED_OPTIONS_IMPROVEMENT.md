# 灵感选项功能改进 - 持续引导模式

> 更新时间：2025-11-22
> 改进需求：每次对话都提供选项，同时支持用户自由输入

---

## 改进目标

### 原有设计
- ❌ 仅在对话前3轮提供 `inspired_options`
- ❌ 第3轮后改用 `text_input`，用户失去选项引导
- ⚠️ 后期对话缺少灵感激发

### 改进后设计
- ✅ **整个对话过程始终提供 inspired_options**
- ✅ **输入框始终开放**，用户可随时自由输入
- ✅ **渐进式选项**：根据对话进展调整选项层级
- ✅ **引导+自由并存**：既提供方向，又保持创作自由度

---

## 核心改进点

### 1. 持续灵感激发

**早期对话（宏观方向）**
```json
{
  "ai_message": "时间主题真是取之不尽的创意宝库！",
  "ui_control": {
    "type": "inspired_options",
    "options": [
      {
        "label": "硬科幻时间旅行",
        "description": "以严谨的物理学为基础，探讨时间悖论...",
        "key_elements": ["时间悖论", "因果律", "平行宇宙"]
      }
    ]
  }
}
```

**中期对话（具体细节）**
```json
{
  "ai_message": "现在让我们定义主角——是什么样的人会踏上这段时间旅程？",
  "ui_control": {
    "type": "inspired_options",
    "options": [
      {
        "label": "理想主义物理学家",
        "description": "年轻的理论物理学家，意外发现时间旅行的可能性...",
        "key_elements": ["科学理想", "道德困境", "成长蜕变"]
      }
    ]
  }
}
```

**后期对话（深化选择）**
```json
{
  "ai_message": "让我们确定故事的篇幅规模：",
  "ui_control": {
    "type": "inspired_options",
    "options": [
      {
        "label": "紧凑短篇（20-50章）",
        "description": "单一时间线，聚焦核心悖论，快节奏推进...",
        "key_elements": ["紧凑节奏", "单线叙事", "核心聚焦"]
      }
    ]
  }
}
```

---

### 2. 用户体验优化

**双重交互方式**：

1. **点击选项** → 快速选择AI提供的方向
   ```
   用户点击"硬科幻时间旅行"
   → 自动发送消息："选择：硬科幻时间旅行"
   → AI继续深化对话
   ```

2. **自由输入** → 不受选项限制，完全自由创作
   ```
   用户输入："我想写一个关于量子纠缠的故事"
   → AI分析输入，提供相关延伸选项
   ```

**Placeholder动态提示**：
- 有选项时："选择上面的选项，或输入你的新想法..."
- 无选项时："输入你的想法..."

---

## 修改的文件

### 1. `backend/prompts/inspiration.md` ⭐ 核心修改

**Lines 12-24**：更新 Guiding Principles

**原有规则**：
```markdown
4. Creative Inspired Options (对话前3轮)
5. Flexible Choice Guidance (对话后期) - 改用text_input
```

**修改后规则**：
```markdown
4. Creative Inspired Options (持续引导)
   - 在整个对话过程中始终使用 inspired_options
   - 选项设计原则：
     * 早期对话：提供宏观方向选择（类型、基调、世界观等）
     * 中期对话：提供具体细节选择（主角特质、冲突类型、催化事件等）
     * 后期对话：提供深化选择（主题深度、风格偏好、篇幅规划等）

5. User Authority (完全自由)
   - 输入框始终保持开放
   - placeholder提示："选择上面的选项，或输入你的新想法..."

6. Adaptive Options (动态调整)
   - 如果用户选择了某个选项，下一轮提供该方向的深化选项
   - 如果用户自由输入，分析输入内容，提供相关的延伸选项
   - 避免重复提供已讨论过的选项，始终保持新鲜感
```

**Lines 49-52**：更新对话流程

**原有逻辑**：
```markdown
- 如果是对话轮次 <= 3: 使用 inspired_options
- 如果是对话轮次 > 3: 使用 text_input
```

**修改后逻辑**：
```markdown
- 始终使用 inspired_options 类型：无论对话轮次，每次都提供3-5个丰富的选项
- 每个选项必须包含：label（8-12字）、description（50-100字）、key_elements（2-3个标签）
- 根据对话进展调整选项的抽象层级：早期宏观方向 → 中期具体细节 → 后期深化选择
```

**Lines 87-129**：新增后续对话示例

添加了第2轮对话示例，展示如何在用户选择"硬科幻时间旅行"后，继续提供主角设计的选项。

---

### 2. `backend/app/api/routers/novels/inspiration.py`

**Lines 64-72**：更新 JSON_RESPONSE_INSTRUCTION

**原有说明**：
```python
**何时使用inspired_options：**
- 对话轮次 <= 3 且用户刚提供初步想法
```

**修改后说明**：
```python
**何时使用inspired_options：**
- **推荐：在整个对话过程中始终使用**，持续为用户提供灵感激发
- 根据对话进展调整选项层级：
  * 早期：宏观方向（类型、基调、世界观）
  * 中期：具体细节（主角特质、冲突类型、催化事件）
  * 后期：深化选择（主题深度、风格偏好、篇幅规划）
- placeholder应提示用户可以自由输入："选择上面的选项，或输入你的新想法..."
```

**Lines 101-106**：更新重要说明

**原有说明**：
```python
- 对话轮次 > 3 后，应逐渐减少使用inspired_options，改用text_input引导用户深入细节
```

**修改后说明**：
```python
- **推荐始终使用 inspired_options**，在整个对话过程中持续提供灵感激发选项
- 用户可以点击选项或自由输入，两种方式并存
```

---

### 3. `frontend/windows/inspiration_mode/main.py`

**Line 270**：更新默认 placeholder

```python
placeholder = ui_control.get('placeholder', '选择上面的选项，或输入你的新想法...')
```

**原来**：`'或者输入你的新想法...'`
**改为**：`'选择上面的选项，或输入你的新想法...'`

更清晰地提示用户有两种交互方式。

---

## 设计优势

### 1. 持续激发创意

- ✅ **全程引导**：从宏观到微观，层层递进
- ✅ **避免迷失**：用户在任何阶段都有明确的选择方向
- ✅ **保持新鲜**：每轮选项都根据上下文动态调整

### 2. 保持创作自由

- ✅ **不强制选择**：输入框始终可用
- ✅ **灵活切换**：可以先选几轮，后面自由发挥
- ✅ **创意优先**：选项仅作为灵感来源，不限制用户想法

### 3. 符合产品定位

- ✅ **"灵感模式"**：名副其实，持续提供灵感
- ✅ **AI辅助创作**：既有AI智能引导，又尊重用户主导权
- ✅ **降低创作门槛**：新手可以全程依赖选项，老手可以自由输入

---

## 对话流程示例

### 完整对话演示

**第1轮：宏观方向**
```
AI: "灵感像猫，总在不经意间跳上你的书桌。告诉我，它这次给你留下了什么？"
User: "我想写一个关于时间的故事"

AI: "时间主题真是取之不尽的创意宝库！我为你准备了几种不同的探索路径："
[显示4个选项：硬科幻时间旅行 | 奇幻时间魔法 | 情感时光倒流 | 时间循环悬疑]
```

**第2轮：具体细节**
```
User: 点击"硬科幻时间旅行"

AI: "太好了！现在让我们定义主角——是什么样的人会踏上这段时间旅程？"
[显示3个选项：理想主义物理学家 | 失意的时间执法者 | 被困的时间旅行者]
```

**第3轮：自由输入**
```
User: 输入"我想要一个黑人女科学家，她发明了时间机器但被政府追捕"

AI: "精彩！一个被追捕的黑人女科学家，这为故事增添了种族和性别的社会维度。
现在让我们定义她的核心冲突："
[显示3个选项：逃避vs正义抗争 | 科学vs道德 | 个人自由vs集体利益]
```

**第4轮：深化选择**
```
User: 点击"逃避vs正义抗争"

AI: "很有张力！她在逃避中逐渐意识到自己的责任。让我们确定故事的篇幅规模："
[显示4个选项：紧凑短篇(20-50章) | 中篇叙事(50-100章) | 长篇史诗(100-200章) | 自定义]
```

---

## 技术细节

### Prompt工程策略

**动态选项生成规则**：

```markdown
1. 分析用户回答，识别已确认的信息点
2. 对照内部清单，找出下一个逻辑问题
3. 根据问题类型，生成对应层级的选项：
   - 宏观问题 → 提供多样化方向（类型差异大）
   - 细节问题 → 提供具体化选择（特质差异明显）
   - 深化问题 → 提供专业化建议（风格偏好）
4. 确保选项互斥且覆盖主要可能性
5. 每个选项包含足够信息让用户想象具体画面
```

**Placeholder动态调整**：

```python
# 前端逻辑
if control_type == 'inspired_options':
    placeholder = ui_control.get('placeholder', '选择上面的选项，或输入你的新想法...')
else:
    placeholder = '输入你的想法...'
```

---

## 测试验证

### 手动测试清单

- [ ] 第1轮对话是否显示选项
- [ ] 点击选项是否正确发送消息
- [ ] 输入框是否始终可用
- [ ] Placeholder是否动态更新
- [ ] 第2轮对话是否继续显示选项
- [ ] 第3轮及以后是否保持选项显示
- [ ] 自由输入后AI是否提供相关选项
- [ ] 选项内容是否根据对话进展深化
- [ ] 对话完成后是否显示"生成蓝图"按钮

---

## 相关文档

- [INSPIRED_OPTIONS_FEATURE.md](INSPIRED_OPTIONS_FEATURE.md) - 原始功能实现文档
- [backend/prompts/inspiration.md](../backend/prompts/inspiration.md) - 灵感对话Prompt模板
- [backend/app/api/routers/novels/inspiration.py](../backend/app/api/routers/novels/inspiration.py) - 后端路由实现

---

**开发者**：Claude Code
**更新时间**：2025-11-22
**版本**：2.0.0 - 持续引导模式
**状态**：✅ 已完成
